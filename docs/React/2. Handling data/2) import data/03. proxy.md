## 개발자를 괴롭히는 CORS 오류, 프록시(Proxy)로 해결하기

React 개발 중 `fetch`로 외부 API에 데이터를 요청했을 때, 콘솔에 나타나는 빨간 CORS 오류 메시지는 많은 개발자를 당황하게 만듭니다. 이 글에서는 CORS 오류가 왜 발생하는지, 그리고 Vite 환경에서 **프록시(Proxy)** 를 이용해 이 문제를 어떻게 해결하는지 알아보겠습니다.

### CORS 오류, 도대체 왜 발생할까? 🛡️

CORS(Cross-Origin Resource Sharing, 교차 출처 리소스 공유) 오류는 웹 브라우저의 **'동일 출처 정책(Same-Origin Policy)'** 때문에 발생합니다. 이는 보안상의 이유로, 다른 '출처(Origin)'를 가진 리소스를 함부로 가져오지 못하도록 막는 중요한 보안 규칙입니다.

이때 '출처'는 **프로토콜, 호스트(도메인), 포트 번호**의 조합으로 결정됩니다.

- **내 React 앱 (요청을 보내는 곳):** `http://localhost:5173`
- **외부 API 서버 (요청을 받는 곳):** `https://api.example.com`

이 둘은 출처가 다르므로, 브라우저는 기본적으로 데이터 요청을 차단합니다. 외부 API 서버가 응답 헤더에 "이 출처(`http://localhost:5173`)는 데이터를 가져가도 좋아"라는 허가(`Access-Control-Allow-Origin`)를 명시적으로 보내주지 않는 한, 브라우저는 이 요청을 거부하고 CORS 오류를 발생시키는 것이죠.

### 해결책: Vite 개발 서버를 '대리인'으로 만들기 (Proxy)

우리가 외부 API 서버의 설정을 직접 바꿀 수는 없으므로, 개발 환경에서는 **프록시(Proxy)** 라는 우회 전략을 사용합니다. 프록시는 '대리인'이라는 뜻으로, Vite 개발 서버가 우리 React 앱을 대신해서 외부 API 서버에 데이터를 요청하고 받아오는 방식입니다.

**프록시가 없을 때 (CORS 오류 발생)**

```
[React App on localhost:5173] ---❌ (CORS Block by Browser) ---> [External API Server]
```

**프록시를 사용할 때 (성공)**

```
[React App] <---> [Vite Dev Server (Proxy)] <---> [External API Server]
```

1.  **React 앱**은 같은 출처인 **Vite 개발 서버**에 데이터를 요청합니다. (CORS 문제 없음)
2.  **Vite 개발 서버(프록시)** 는 요청을 받아 우리를 대신해서 **외부 API 서버**에 전달합니다. (서버 간 통신에는 CORS 정책이 적용되지 않음)
3.  **Vite 개발 서버**는 외부 서버로부터 받은 데이터를 **React 앱**에 안전하게 전달합니다.

---

### Vite 프록시 설정 방법

#### 1단계: `vite.config.js` 파일 설정

프로젝트의 루트 디렉토리에 있는 `vite.config.js` 파일을 열고, `server.proxy` 옵션을 추가합니다.

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      // '/api'로 시작하는 경로의 요청은 target으로 전달합니다.
      '/api': {
        // 실제 API 서버 주소를 입력합니다.
        target: 'https://learn.codeit.kr',
        // 출처(Origin) 헤더를 target 주소에 맞게 변경합니다.
        changeOrigin: true,
        // 요청 경로에서 '/api'를 제거합니다.
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },
});
```

#### 2단계: `fetch` 요청 주소 수정

API를 호출하는 파일(예: `src/api.js`)에서 `fetch` 함수의 주소를 프록시 경로에 맞게 수정합니다.

```javascript
// src/api.js

// 수정 전
// const response = await fetch('https://learn.codeit.kr/1029/foods');

// 수정 후 👇
export async function getFoods() {
  const response = await fetch('/api/1029/foods');
  // ...
}
```

#### 3단계: 개발 서버 재시작

설정을 마친 후에는 반드시 Vite 개발 서버를 껐다가(`Ctrl` + `C`) 다시 실행(`npm run dev`)해야 프록시 설정이 적용됩니다.

이제 React 앱에서 `/api/1029/foods`로 보내는 모든 요청은 Vite 개발 서버에 의해 안전하게 `https://learn.codeit.kr/1029/foods`로 전달되므로, 더 이상 CORS 오류 없이 데이터를 받아올 수 있습니다.
